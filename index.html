<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∫–æ–ª—å–Ω–∏–π –©–æ–¥–µ–Ω–Ω–∏–∫ - –°–∏—Å—Ç–µ–º–∞ –ê–∫–∫–∞—É–Ω—Ç—ñ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Auth Styles */
        .auth-container {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .auth-container.active {
            display: flex;
        }

        .auth-card {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .auth-card h2 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 600;
            color: #999;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .user-role-select {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-option {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .role-option.selected {
            border-color: #667eea;
            background: #f0f2ff;
        }

        /* Main App Styles */
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            flex: 1;
        }

        .user-info {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            font-size: 14px;
        }

        .btn-logout {
            background: rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border: 1px solid white;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255,255,255,0.5);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="password"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .students-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .student-item {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .student-item:hover {
            background: #f0f2ff;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .student-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .student-email {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .student-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            flex: 1;
        }

        .btn-delete {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-grade {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .grades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .grades-table thead {
            background: #f8f9fa;
        }

        .grades-table th {
            padding: 12px;
            text-align: left;
            color: #667eea;
            font-weight: 600;
            border-bottom: 2px solid #667eea;
        }

        .grades-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        .grades-table tr:hover {
            background: #f8f9fa;
        }

        .grade-cell {
            background: #fff8e1;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: 600;
            color: #f5a623;
        }

        .no-data {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-header {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .modal-close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .modal-close:hover {
            color: #000;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
        }

        .btn-cancel {
            background: #ccc;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }
        }

        .hidden {
            display: none !important;
        }

        .teacher-only {
            display: none;
        }

        .teacher-only.visible {
            display: block;
        }

        .admin-only {
            display: none;
        }

        .admin-only.visible {
            display: block;
        }

        .director-only {
            display: none;
        }

        .director-only.visible {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div class="auth-container active" id="authContainer">
        <div class="auth-card">
            <h2>üéì –®–∫–æ–ª—å–Ω–∏–π –©–æ–¥–µ–Ω–Ω–∏–∫</h2>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">–í—Ö—ñ–¥</button>
                <button class="auth-tab staff-only-tab" onclick="switchAuthTab('register')">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label>–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ</label>
                    <input type="text" id="loginName" required placeholder="–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" style="width: 100%;">–£–≤—ñ–π—Ç–∏</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="auth-form" style="display: none;">
                <div class="user-role-select" id="roleSelect">
                    <div class="role-option selected" data-role="teacher">
                        <strong>üë®‚Äçüè´ –í—á–∏—Ç–µ–ª—å</strong>
                    </div>
                    <div class="role-option" data-role="admin">
                        <strong>üìã –ó–∞–≤—É—á</strong>
                    </div>
                    <div class="role-option" data-role="director">
                        <strong>üëî –î–∏—Ä–µ–∫—Ç–æ—Ä</strong>
                    </div>
                </div>

                <div class="form-group">
                    <label>–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ</label>
                    <input type="text" id="registerName" required placeholder="–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="registerEmail" required placeholder="example@mail.com">
                </div>
                <div class="form-group" id="classField" style="display: none;">
                    <label>–ö–ª–∞—Å</label>
                    <input type="text" id="registerClass" placeholder="10–ê">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPassword2" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" style="width: 100%;">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="container" id="appContainer" style="display: none;">
        <header>
            <h1>üìö –®–∫–æ–ª—å–Ω–∏–π –©–æ–¥–µ–Ω–Ω–∏–∫</h1>
            <div style="display: flex; align-items: center;">
                <div class="user-info">
                    <span id="userGreeting"></span>
                </div>
                <button class="btn-logout" onclick="logout()">–í–∏—Ö—ñ–¥</button>
            </div>
        </header>

        <div class="alert alert-success" id="alert"></div>
        <div class="alert alert-error" id="alertError"></div>

        <div class="stats" id="stats">
            <div class="stat-box">
                <div class="stat-number" id="totalStudents">0</div>
                <div class="stat-label">–í—Å—å–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="totalGrades">0</div>
                <div class="stat-label">–í—Å—å–æ–≥–æ –æ—Ü—ñ–Ω–æ–∫</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="avgGrade">0</div>
                <div class="stat-label">–°–µ—Ä–µ–¥–Ω—è –æ—Ü—ñ–Ω–∫–∞</div>
            </div>
        </div>

        <div class="main-content">
            <!-- Admin Panel - Add Teachers -->
            <div class="card admin-only" id="adminPanel">
                <h2>‚ûï –î–æ–¥–∞—Ç–∏ –≤—á–∏—Ç–µ–ª—è</h2>
                <form id="teacherForm">
                    <div class="form-group">
                        <label for="teacherName">–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ</label>
                        <input type="text" id="teacherName" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ">
                    </div>
                    <div class="form-group">
                        <label for="teacherEmail">Email</label>
                        <input type="email" id="teacherEmail" required placeholder="teacher@example.com">
                    </div>
                    <div class="form-group">
                        <label for="teacherPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="teacherPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit">–î–æ–¥–∞—Ç–∏ –≤—á–∏—Ç–µ–ª—è</button>
                </form>
            </div>

            <!-- Director Panel - Add Admin/Teachers -->
            <div class="card director-only" id="directorPanel">
                <h2>üë• –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º</h2>
                
                <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 15px;">‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–≤—É—á–∞</h3>
                <form id="adminForm">
                    <div class="form-group">
                        <label for="adminName">–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ</label>
                        <input type="text" id="adminName" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ">
                    </div>
                    <div class="form-group">
                        <label for="adminEmail">Email</label>
                        <input type="email" id="adminEmail" required placeholder="admin@example.com">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="adminPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit">–î–æ–¥–∞—Ç–∏ –∑–∞–≤—É—á–∞</button>
                </form>
            </div>

            <!-- Teacher Panel - Add Students -->
            <div class="card teacher-only" id="teacherPanel">
                <h2>‚ûï –î–æ–¥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</h2>
                <form id="studentForm">
                    <div class="form-group">
                        <label for="studentName">–Ü–º'—è —Å—Ç—É–¥–µ–Ω—Ç–∞</label>
                        <input type="text" id="studentName" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ">
                    </div>
                    <div class="form-group">
                        <label for="studentEmail">Email</label>
                        <input type="email" id="studentEmail" required placeholder="student@example.com">
                    </div>
                    <div class="form-group">
                        <label for="studentClass">–ö–ª–∞—Å</label>
                        <input type="text" id="studentClass" required placeholder="10–ê">
                    </div>
                    <div class="form-group">
                        <label for="studentPassword">–ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥—É</label>
                        <input type="password" id="studentPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit">–î–æ–¥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</button>
                </form>

                <h2 style="margin-top: 30px;">‚≠ê –ü–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É</h2>
                <form id="gradeForm">
                    <div class="form-group">
                        <label for="gradeStudent">–°—Ç—É–¥–µ–Ω—Ç</label>
                        <select id="gradeStudent" required>
                            <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gradeName">–ü—Ä–µ–¥–º–µ—Ç/–ó–∞–≤–¥–∞–Ω–Ω—è</label>
                        <input type="text" id="gradeName" required placeholder="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞">
                    </div>
                    <div class="form-group">
                        <label for="gradeValue">–û—Ü—ñ–Ω–∫–∞ (1-12)</label>
                        <input type="number" id="gradeValue" min="1" max="12" required placeholder="10">
                    </div>
                    <button type="submit">–ü–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É</button>
                </form>
            </div>

            <!-- Students and Grades Display -->
            <div class="card">
                <h2>üë• –°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —Ç–∞ –æ—Ü—ñ–Ω–æ–∫</h2>
                <div class="students-list" id="studentsList">
                    <div class="no-data">–°—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞!</div>
                </div>

                <h2 style="margin-top: 30px;">üìä –¢–∞–±–ª–∏—Ü—è –æ—Ü—ñ–Ω–æ–∫</h2>
                <div id="gradesTableContainer">
                    <p class="no-data">–û—Ü—ñ–Ω–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>
                </div>

                <!-- Staff List - visible for director, admin, and teachers -->
                <div style="display: none;" class="admin-only teacher-only" id="staffSection">
                    <h2 style="margin-top: 30px;">üë®‚Äçüíº –ü–µ—Ä—Å–æ–Ω–∞–ª —à–∫–æ–ª–∏</h2>
                    
                    <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 15px;">üìã –ó–∞–≤—É—á—ñ</h3>
                    <div id="adminsList">
                        <p class="no-data">–ó–∞–≤—É—á—ñ–≤ –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î</p>
                    </div>

                    <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 15px;">üë®‚Äçüè´ –í—á–∏—Ç–µ–ª—ñ</h3>
                    <div id="teachersList">
                        <p class="no-data">–í—á–∏—Ç–µ–ª—ñ–≤ –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grade Detail Modal -->
    <div id="gradeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div class="modal-header">
                <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ—Ü—ñ–Ω–∫—É</h3>
            </div>
            <form id="editGradeForm">
                <div class="form-group">
                    <label for="editGradeValue">–ù–æ–≤–∞ –æ—Ü—ñ–Ω–∫–∞ (1-12)</label>
                    <input type="number" id="editGradeValue" min="1" max="12" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" id="cancelBtn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data structure
        const appData = {
            users: [],
            students: [],
            grades: []
        };

        let currentUser = null;
        let currentEditGradeId = null;

        // Hash password (simple implementation)
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString();
        }

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('schoolDiaryData');
            if (saved) {
                Object.assign(appData, JSON.parse(saved));
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('schoolDiaryData', JSON.stringify(appData));
            updateStats();
            updateGradeSelect();
            renderStudents();
            renderGrades();
            renderAdminsList();
            renderTeachersList();
        }

        // Auth Tab Switching
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            event.target.classList.add('active');
            const form = document.getElementById(tab + 'Form');
            form.classList.add('active');
            form.style.display = 'block';

            if (tab === 'register') {
                document.getElementById('classField').style.display = 'none';
            }
        }

        // Role Selection
        document.querySelectorAll('.role-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.role-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                
                const role = this.getAttribute('data-role');
                // Only show class field for teachers (removed student role)
                document.getElementById('classField').style.display = 'none';
            });
        });

        // Register
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const password2 = document.getElementById('registerPassword2').value;
            const selectedRole = document.querySelector('.role-option.selected').getAttribute('data-role');

            if (password !== password2) {
                showAlert('–ü–∞—Ä–æ–ª—ñ –Ω–µ –∑–±—ñ–≥–∞—é—Ç—å—Å—è!', 'error');
                return;
            }

            if (appData.users.find(u => u.name === name)) {
                showAlert('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ —Ç–∞–∫–∏–º —ñ–º\'—è–º –≤–∂–µ —ñ—Å–Ω—É—î!', 'error');
                return;
            }

            const user = {
                id: Date.now(),
                name,
                email,
                password: hashPassword(password),
                role: selectedRole,
                class: null
            };

            appData.users.push(user);
            localStorage.setItem('schoolDiaryData', JSON.stringify(appData));

            showAlert('‚úÖ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –¢–µ–ø–µ—Ä —É–≤—ñ–π–¥—ñ—Ç—å.', 'success');
            
            setTimeout(() => {
                document.getElementById('registerForm').reset();
                document.querySelectorAll('.role-option').forEach(o => o.classList.remove('selected'));
                document.querySelector('[data-role="teacher"]').classList.add('selected');
                switchAuthTab('login');
            }, 1500);
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('loginName').value;
            const password = document.getElementById('loginPassword').value;
            const hashedPassword = hashPassword(password);

            console.log('Login attempt:', { name, hashedPassword });
            console.log('Available users:', appData.users);

            const user = appData.users.find(u => u.name === name && u.password === hashedPassword);

            if (!user) {
                console.log('User not found or password mismatch');
                showAlert('–ù–µ–≤—ñ—Ä–Ω–µ —ñ–º\'—è –∞–±–æ –ø–∞—Ä–æ–ª—å!', 'error');
                return;
            }

            console.log('User found, logging in:', user);
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(user));

            // Show main app
            console.log('Auth container before:', document.getElementById('authContainer').classList);
            console.log('App container display before:', document.getElementById('appContainer').style.display);
            
            const authContainer = document.getElementById('authContainer');
            const appContainer = document.getElementById('appContainer');
            
            authContainer.style.display = 'none';
            appContainer.style.display = 'block';

            console.log('Auth container after:', document.getElementById('authContainer').style.display);
            console.log('App container display after:', document.getElementById('appContainer').style.display);

            // Setup UI based on role
            if (user.role === 'teacher') {
                console.log('Setting up teacher UI');
                document.querySelectorAll('.teacher-only').forEach(el => {
                    console.log('Adding visible class to:', el);
                    el.classList.add('visible');
                });
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
                document.querySelectorAll('.director-only').forEach(el => el.classList.remove('visible'));
                updateGradeSelect();
            } else if (user.role === 'admin') {
                console.log('Setting up admin UI');
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('visible'));
                document.querySelectorAll('.teacher-only').forEach(el => el.classList.remove('visible'));
                document.querySelectorAll('.director-only').forEach(el => el.classList.remove('visible'));
            } else if (user.role === 'director') {
                console.log('Setting up director UI');
                // Director has access to all panels
                document.querySelectorAll('.director-only').forEach(el => el.classList.add('visible'));
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('visible'));
                document.querySelectorAll('.teacher-only').forEach(el => el.classList.add('visible'));
                updateGradeSelect();
            } else if (user.role === 'student') {
                console.log('Setting up student UI');
                // Students see only their grades
                document.querySelectorAll('.teacher-only').forEach(el => el.classList.remove('visible'));
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
                document.querySelectorAll('.director-only').forEach(el => el.classList.remove('visible'));
            } else {
                document.querySelectorAll('.teacher-only').forEach(el => el.classList.remove('visible'));
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
                document.querySelectorAll('.director-only').forEach(el => el.classList.remove('visible'));
            }

            // Load and display data
            loadData();
            const roleText = {
                'teacher': '–í—á–∏—Ç–µ–ª—å',
                'admin': '–ó–∞–≤—É—á',
                'director': '–î–∏—Ä–µ–∫—Ç–æ—Ä',
                'student': '–°—Ç—É–¥–µ–Ω—Ç'
            };
            document.getElementById('userGreeting').textContent = `üë§ ${user.name} (${roleText[user.role] || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'})`;
            
            console.log('Calling updateStats...');
            try {
                updateStats();
                console.log('updateStats completed');
            } catch(err) {
                console.error('Error in updateStats:', err);
            }
            
            console.log('Calling renderStudents...');
            try {
                renderStudents();
                console.log('renderStudents completed');
            } catch(err) {
                console.error('Error in renderStudents:', err);
            }
            
            console.log('Calling renderGrades...');
            try {
                renderGrades();
                console.log('renderGrades completed');
            } catch(err) {
                console.error('Error in renderGrades:', err);
            }
            
            console.log('Login completed successfully');
        });

        // Logout
        function logout() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–π—Ç–∏?')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                document.getElementById('authContainer').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
                document.querySelectorAll('.role-option').forEach(o => o.classList.remove('selected'));
                document.querySelector('[data-role="teacher"]').classList.add('selected');
            }
        }

        // Add student
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('studentName').value;
            const email = document.getElementById('studentEmail').value;
            const classNum = document.getElementById('studentClass').value;
            const password = document.getElementById('studentPassword').value;

            // Create student account user
            const studentUser = {
                id: Date.now(),
                name,
                email,
                password: hashPassword(password),
                role: 'student',
                class: classNum
            };

            appData.users.push(studentUser);

            const student = {
                id: Date.now() + 1,
                teacherId: currentUser.id,
                name,
                email,
                class: classNum
            };

            appData.students.push(student);
            saveData();
            
            this.reset();
            showAlert('‚úÖ –°—Ç—É–¥–µ–Ω—Ç–∞ —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ! –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥—É: ' + password, 'success');
        });

        // Add teacher (by admin or director)
        if (document.getElementById('teacherForm')) {
            document.getElementById('teacherForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('teacherName').value;
                const email = document.getElementById('teacherEmail').value;
                const password = document.getElementById('teacherPassword').value;

                if (appData.users.find(u => u.name === name)) {
                    showAlert('–í—á–∏—Ç–µ–ª—å –∑ —Ç–∞–∫–∏–º —ñ–º\'—è–º –≤–∂–µ —ñ—Å–Ω—É—î!', 'error');
                    return;
                }

                const teacher = {
                    id: Date.now(),
                    name,
                    email,
                    password: hashPassword(password),
                    role: 'teacher',
                    class: null
                };

                appData.users.push(teacher);
                localStorage.setItem('schoolDiaryData', JSON.stringify(appData));
                
                this.reset();
                showAlert('‚úÖ –í—á–∏—Ç–µ–ª—è —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!', 'success');
            });
        }

        // Add admin (by director only)
        if (document.getElementById('adminForm')) {
            document.getElementById('adminForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('adminName').value;
                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;

                if (appData.users.find(u => u.name === name)) {
                    showAlert('–ó–∞–≤—É—á –∑ —Ç–∞–∫–∏–º —ñ–º\'—è–º –≤–∂–µ —ñ—Å–Ω—É—î!', 'error');
                    return;
                }

                const admin = {
                    id: Date.now(),
                    name,
                    email,
                    password: hashPassword(password),
                    role: 'admin',
                    class: null
                };

                appData.users.push(admin);
                localStorage.setItem('schoolDiaryData', JSON.stringify(appData));
                
                this.reset();
                showAlert('‚úÖ –ó–∞–≤—É—á–∞ —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!', 'success');
            });
        }

        // Add grade
        document.getElementById('gradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentId = parseInt(document.getElementById('gradeStudent').value);
            const gradeName = document.getElementById('gradeName').value;
            const gradeValue = parseInt(document.getElementById('gradeValue').value);

            const grade = {
                id: Date.now(),
                teacherId: currentUser.id,
                studentId,
                name: gradeName,
                value: gradeValue,
                date: new Date().toLocaleDateString('uk-UA')
            };

            appData.grades.push(grade);
            saveData();
            
            this.reset();
            showAlert('‚≠ê –û—Ü—ñ–Ω–∫—É —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!', 'success');
        });

        // Update grade select options (only teacher's students)
        function updateGradeSelect() {
            const select = document.getElementById('gradeStudent');
            select.innerHTML = '<option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ --</option>';
            
            const myStudents = appData.students.filter(s => s.teacherId === currentUser.id);
            myStudents.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = `${student.name} (${student.class})`;
                select.appendChild(option);
            });
        }

        // Render students list (only teacher's students)
        function renderStudents() {
            const container = document.getElementById('studentsList');
            
            let studentsToShow;
            if (currentUser.role === 'teacher') {
                studentsToShow = appData.students.filter(s => s.teacherId === currentUser.id);
            } else if (currentUser.role === 'director' || currentUser.role === 'admin') {
                // Admin and director see all students
                studentsToShow = appData.students;
            } else {
                studentsToShow = appData.students;
            }
            
            if (studentsToShow.length === 0) {
                container.innerHTML = '<div class="no-data">–°—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞!</div>';
                return;
            }

            container.innerHTML = studentsToShow.map(student => {
                const studentGrades = appData.grades.filter(g => g.studentId === student.id);
                const avgGrade = studentGrades.length > 0
                    ? (studentGrades.reduce((sum, g) => sum + g.value, 0) / studentGrades.length).toFixed(1)
                    : '-';

                let actions = `<button class="btn-small btn-grade" onclick="showGradesForStudent(${student.id})">–û—Ü—ñ–Ω–∫–∏</button>`;
                if (currentUser.role === 'teacher' || currentUser.role === 'director' || currentUser.role === 'admin') {
                    actions += `<button class="btn-small btn-delete" onclick="deleteStudent(${student.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button>`;
                }

                return `
                    <div class="student-item">
                        <div class="student-name">${student.name}</div>
                        <div class="student-email">${student.email}</div>
                        <div style="color: #666; font-size: 14px; margin-bottom: 10px;">–ö–ª–∞—Å: <strong>${student.class}</strong> | –û—Ü—ñ–Ω–æ–∫: <strong>${studentGrades.length}</strong> | –°–µ—Ä–µ–¥–Ω—è: <strong>${avgGrade}</strong></div>
                        <div class="student-actions">
                            ${actions}
                        </div>
                    </div>
                `;
            }).join('');

            // Show staff section if user is admin, director or teacher
            if (currentUser.role === 'admin' || currentUser.role === 'director' || currentUser.role === 'teacher') {
                document.getElementById('staffSection').style.display = 'block';
                renderAdminsList();
                renderTeachersList();
            }
        }

        // Render admins/zavuchs list
        function renderAdminsList() {
            const container = document.getElementById('adminsList');
            const admins = appData.users.filter(u => u.role === 'admin');

            if (admins.length === 0) {
                container.innerHTML = '<p class="no-data">–ó–∞–≤—É—á—ñ–≤ –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î</p>';
                return;
            }

            container.innerHTML = admins.map(admin => `
                <div class="student-item">
                    <div class="student-name">${admin.name}</div>
                    <div class="student-email">${admin.email}</div>
                    <div style="color: #666; font-size: 14px;">–†–æ–ª—å: <strong>–ó–∞–≤—É—á</strong></div>
                    ${currentUser.role === 'director' ? `<div class="student-actions"><button class="btn-small btn-delete" onclick="deleteUser(${admin.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button></div>` : ''}
                </div>
            `).join('');
        }

        // Render teachers list
        function renderTeachersList() {
            const container = document.getElementById('teachersList');
            const teachers = appData.users.filter(u => u.role === 'teacher');

            if (teachers.length === 0) {
                container.innerHTML = '<p class="no-data">–í—á–∏—Ç–µ–ª—ñ–≤ –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î</p>';
                return;
            }

            container.innerHTML = teachers.map(teacher => `
                <div class="student-item">
                    <div class="student-name">${teacher.name}</div>
                    <div class="student-email">${teacher.email}</div>
                    <div style="color: #666; font-size: 14px;">–†–æ–ª—å: <strong>–í—á–∏—Ç–µ–ª—å</strong></div>
                    ${(currentUser.role === 'director' || currentUser.role === 'admin') ? `<div class="student-actions"><button class="btn-small btn-delete" onclick="deleteUser(${teacher.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button></div>` : ''}
                </div>
            `).join('');
        }

        // Delete user (teacher or admin)
        function deleteUser(userId) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?')) {
                appData.users = appData.users.filter(u => u.id !== userId);
                localStorage.setItem('schoolDiaryData', JSON.stringify(appData));
                renderAdminsList();
                renderTeachersList();
                showAlert('üóëÔ∏è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
            }
        }

        // Render grades table
        function renderGrades() {
            const container = document.getElementById('gradesTableContainer');
            
            let gradesToShow;
            if (currentUser.role === 'teacher') {
                gradesToShow = appData.grades.filter(g => g.teacherId === currentUser.id);
            } else if (currentUser.role === 'director' || currentUser.role === 'admin') {
                // Director and admin see all grades
                gradesToShow = appData.grades;
            } else if (currentUser.role === 'student') {
                // Student sees only their grades - find by looking at which student record matches their email
                const studentRecord = appData.students.find(s => s.email === currentUser.email);
                if (studentRecord) {
                    gradesToShow = appData.grades.filter(g => g.studentId === studentRecord.id);
                } else {
                    gradesToShow = [];
                }
            } else {
                gradesToShow = [];
            }
            
            if (gradesToShow.length === 0) {
                container.innerHTML = '<p class="no-data">–û—Ü—ñ–Ω–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>';
                return;
            }

            const gradesWithStudents = gradesToShow.map(grade => {
                const student = appData.students.find(s => s.id === grade.studentId);
                return { ...grade, studentName: student ? student.name : '–ù–µ–≤—ñ–¥–æ–º–∏–π' };
            }).sort((a, b) => new Date(b.date) - new Date(a.date));

            // For students, show centered grid instead of table
            if (currentUser.role === 'student') {
                let html = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; justify-items: center; margin: 0 auto;">
                `;
                
                gradesWithStudents.forEach(grade => {
                    html += `
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; width: 100%; max-width: 250px;">
                            <div style="font-size: 14px; margin-bottom: 10px; opacity: 0.9;">${grade.name}</div>
                            <div style="font-size: 36px; font-weight: bold; margin-bottom: 10px;">${grade.value}</div>
                            <div style="font-size: 12px; opacity: 0.8;">${grade.date}</div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                container.innerHTML = html;
            } else {
                // For teachers, admin, director - show as table
                let html = `
                    <table class="grades-table">
                        <thead>
                            <tr>
                                <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                                <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                <th>–û—Ü—ñ–Ω–∫–∞</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–î—ñ—ó</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                gradesWithStudents.forEach(grade => {
                    let actions = '';
                    if (currentUser.role === 'teacher' || currentUser.role === 'director' || currentUser.role === 'admin') {
                        actions = `
                            <button class="btn-small btn-grade" onclick="editGrade(${grade.id})">–ó–º—ñ–Ω–∏—Ç–∏</button>
                            <button class="btn-small btn-delete" onclick="deleteGrade(${grade.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                        `;
                    }

                    html += `
                        <tr>
                            <td>${grade.studentName}</td>
                            <td>${grade.name}</td>
                            <td><span class="grade-cell">${grade.value}/12</span></td>
                            <td>${grade.date}</td>
                            <td>${actions}</td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;
            }
        }

        // Update statistics
        function updateStats() {
            let students, grades;
            
            if (currentUser.role === 'teacher') {
                students = appData.students.filter(s => s.teacherId === currentUser.id);
                grades = appData.grades.filter(g => g.teacherId === currentUser.id);
            } else if (currentUser.role === 'director' || currentUser.role === 'admin') {
                // Director and admin see all statistics
                students = appData.students;
                grades = appData.grades;
            } else {
                students = appData.students;
                const studentId = students.find(s => s.email === currentUser.email)?.id;
                grades = studentId ? appData.grades.filter(g => g.studentId === studentId) : [];
            }

            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('totalGrades').textContent = grades.length;
            
            if (grades.length > 0) {
                const avgGrade = (grades.reduce((sum, g) => sum + g.value, 0) / grades.length).toFixed(1);
                document.getElementById('avgGrade').textContent = avgGrade;
            } else {
                document.getElementById('avgGrade').textContent = '0';
            }
        }

        // Delete student
        function deleteStudent(id) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞?')) {
                appData.students = appData.students.filter(s => s.id !== id);
                appData.grades = appData.grades.filter(g => g.studentId !== id);
                saveData();
                showAlert('üóëÔ∏è –°—Ç—É–¥–µ–Ω—Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
            }
        }

        // Delete grade
        function deleteGrade(id) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –æ—Ü—ñ–Ω–∫—É?')) {
                appData.grades = appData.grades.filter(g => g.id !== id);
                saveData();
                showAlert('üóëÔ∏è –û—Ü—ñ–Ω–∫—É –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
            }
        }

        // Edit grade
        function editGrade(id) {
            currentEditGradeId = id;
            const grade = appData.grades.find(g => g.id === id);
            document.getElementById('editGradeValue').value = grade.value;
            document.getElementById('gradeModal').style.display = 'block';
        }

        // Show grades for student
        function showGradesForStudent(studentId) {
            const student = appData.students.find(s => s.id === studentId);
            const studentGrades = appData.grades.filter(g => g.studentId === studentId);
            
            if (studentGrades.length === 0) {
                alert(`–£ —Å—Ç—É–¥–µ–Ω—Ç–∞ ${student.name} –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –æ—Ü—ñ–Ω–æ–∫.`);
                return;
            }

            let message = `–û—Ü—ñ–Ω–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ ${student.name}:\n\n`;
            studentGrades.forEach(g => {
                message += `${g.name}: ${g.value}/12 (${g.date})\n`;
            });

            const avg = (studentGrades.reduce((sum, g) => sum + g.value, 0) / studentGrades.length).toFixed(1);
            message += `\n–°–µ—Ä–µ–¥–Ω—è –æ—Ü—ñ–Ω–∫–∞: ${avg}`;

            alert(message);
        }

        // Modal functionality
        document.getElementById('editGradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const gradeIndex = appData.grades.findIndex(g => g.id === currentEditGradeId);
            appData.grades[gradeIndex].value = parseInt(document.getElementById('editGradeValue').value);
            
            saveData();
            document.getElementById('gradeModal').style.display = 'none';
            showAlert('‚úèÔ∏è –û—Ü—ñ–Ω–∫—É —É—Å–ø—ñ—à–Ω–æ –∑–º—ñ–Ω–µ–Ω–æ!', 'success');
        });

        document.getElementById('cancelBtn').addEventListener('click', function() {
            document.getElementById('gradeModal').style.display = 'none';
        });

        document.querySelector('.modal-close').addEventListener('click', function() {
            document.getElementById('gradeModal').style.display = 'none';
        });

        window.addEventListener('click', function(e) {
            const modal = document.getElementById('gradeModal');
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Show alert
        function showAlert(message, type = 'success') {
            const alertId = type === 'success' ? 'alert' : 'alertError';
            const alertEl = document.getElementById(alertId);
            alertEl.textContent = message;
            alertEl.classList.add(type === 'success' ? 'alert-success' : 'alert-error');
            
            setTimeout(() => {
                alertEl.classList.remove(type === 'success' ? 'alert-success' : 'alert-error');
            }, 3000);
        }

        // Initialize default director account
        function initializeDefaultAccount() {
            loadData();
            
            // Check if director account exists
            let director = appData.users.find(u => u.name === '–ú–∞—Ä–∏–Ω–∞ –Ü–≤–∞–Ω–æ–≤–Ω–∞');
            
            if (!director) {
                // Create new director account
                director = {
                    id: 1702771200000,
                    name: '–ú–∞—Ä–∏–Ω–∞ –Ü–≤–∞–Ω–æ–≤–Ω–∞',
                    email: 'marina@school.com',
                    password: hashPassword('123456789'),
                    role: 'director',
                    class: null
                };
                appData.users.push(director);
            } else {
                // Update existing director password and role
                director.password = hashPassword('123456789');
                director.role = 'director';
            }
            
            localStorage.setItem('schoolDiaryData', JSON.stringify(appData));
        }

        // Check if user is already logged in
        window.addEventListener('load', function() {
            loadData();
            initializeDefaultAccount();
            
            // Hide registration for students (staff only)
            document.querySelector('.staff-only-tab').style.display = 'none';
            
            const saved = localStorage.getItem('currentUser');
            if (saved) {
                currentUser = JSON.parse(saved);
                
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';

                if (currentUser.role === 'teacher') {
                    document.querySelectorAll('.teacher-only').forEach(el => el.classList.add('visible'));
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
                    document.querySelectorAll('.director-only').forEach(el => el.classList.remove('visible'));
                    updateGradeSelect();
                } else if (currentUser.role === 'admin') {
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.add('visible'));
                    document.querySelectorAll('.teacher-only').forEach(el => el.classList.remove('visible'));
                    document.querySelectorAll('.director-only').forEach(el => el.classList.remove('visible'));
                } else if (currentUser.role === 'director') {
                    // Director has access to all panels
                    document.querySelectorAll('.director-only').forEach(el => el.classList.add('visible'));
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.add('visible'));
                    document.querySelectorAll('.teacher-only').forEach(el => el.classList.add('visible'));
                    updateGradeSelect();
                } else if (currentUser.role === 'student') {
                    // Students see only their grades
                    document.querySelectorAll('.teacher-only').forEach(el => el.classList.remove('visible'));
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('visible'));
                    document.querySelectorAll('.director-only').forEach(el => el.classList.remove('visible'));
                }

                const roleText = {
                    'teacher': '–í—á–∏—Ç–µ–ª—å',
                    'admin': '–ó–∞–≤—É—á',
                    'director': '–î–∏—Ä–µ–∫—Ç–æ—Ä',
                    'student': '–°—Ç—É–¥–µ–Ω—Ç'
                };

                document.getElementById('userGreeting').textContent = `üë§ ${currentUser.name} (${roleText[currentUser.role] || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'})`;
                updateStats();
                renderStudents();
                renderGrades();
                
                // Show staff section and render lists for staff members
                if (currentUser.role === 'admin' || currentUser.role === 'director' || currentUser.role === 'teacher') {
                    document.getElementById('staffSection').style.display = 'block';
                    renderAdminsList();
                    renderTeachersList();
                }
            }
        });
    </script>
</body>
</html>
